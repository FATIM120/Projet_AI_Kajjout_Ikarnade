{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card main-card">
                <div class="card-body text-center">
                    <h2 class="card-title mb-4">{{ t('generating') }}</h2>
                    
                    <div class="generation-animation">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="progress-container mt-4">
                        <div class="progress">
                            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%;" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                        <p id="statusText" class="mt-2">{{ t('progress') }} {{ t('step1') }}</p>
                    </div>
                    
                    <div class="generation-tips mt-4">
                        <h5>While you wait...</h5>
                        <div class="tips-carousel">
                            <div class="tip-item active">
                                <p><i class="fas fa-lightbulb"></i> Great video ads typically keep messaging clear and concise.</p>
                            </div>
                            <div class="tip-item">
                                <p><i class="fas fa-paint-brush"></i> Using consistent visual styles helps with brand recognition.</p>
                            </div>
                            <div class="tip-item">
                                <p><i class="fas fa-volume-up"></i> Audio quality is just as important as video quality!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Tips carousel
    const tipItems = document.querySelectorAll('.tip-item');
    let currentTip = 0;
    
    function rotateTips() {
        tipItems.forEach(item => item.classList.remove('active'));
        currentTip = (currentTip + 1) % tipItems.length;
        tipItems[currentTip].classList.add('active');
    }
    
    setInterval(rotateTips, 5000);
    
    // Progress simulation and video generation
    let progress = 0;
    const progressBar = document.getElementById('progressBar');
    const statusText = document.getElementById('statusText');
    const progressSteps = [
        { percent: 10, status: "{{ t('step1') }}" },
        { percent: 30, status: "{{ t('step2') }}" },
        { percent: 50, status: "{{ t('step3') }}" },
        { percent: 70, status: "{{ t('step4') }}" },
        { percent: 90, status: "{{ t('step5') }}" },
        { percent: 100, status: "Complete" }
    ];
    
    // Start the generation process
    document.addEventListener('DOMContentLoaded', function() {
        // Start the actual generation via AJAX
        fetch('{{ url_for("process_generation") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                statusText.textContent = "Error: " + data.error;
                statusText.classList.add('text-danger');
            } else if (data.redirect) {
                // Set progress to 100% and redirect
                updateProgress(100, 'Complete');
                setTimeout(() => {
                    window.location.href = data.redirect;
                }, 1000);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            statusText.textContent = "An unexpected error occurred. Please try again.";
            statusText.classList.add('text-danger');
        });
    });
    
    function updateProgress(percent, status) {
        progressBar.style.width = percent + '%';
        progressBar.textContent = percent + '%';
        progressBar.setAttribute('aria-valuenow', percent);
        statusText.textContent = "{{ t('progress') }} " + status;
    }
</script>
{% endblock %}
